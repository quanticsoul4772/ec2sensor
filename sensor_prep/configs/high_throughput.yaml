# High-Throughput Testing Configuration
# Sensor optimized for performance testing and high-volume traffic

name: high_throughput
description: High-performance sensor for load testing and throughput analysis

# AWS Configuration (high-performance instance)
aws:
  ami_id: ami-0d2ba411d9fd7f677  # BroLin 28.0.6 release
  instance_type: c6in.2xlarge    # Network-optimized instance
  disk_space: 1000gb
  region: us-east-1

# Sensor Metadata
sensor:
  team: platform
  branch: testing
  username: ${USER}
  use_type: TEMPORARY

# Network Interfaces
interfaces:
  eth0: management
  eth1: monitor  # High-bandwidth monitoring

# Sensor Features
brolin_config:
  # Base features
  http.access.enable: 1
  license.yara.enable: 1
  license.suricata.enable: 1
  license.smartpcap.enable: 1

  # Performance optimizations
  # These may need tuning based on actual traffic
  # bro.threads: 8
  # suricata.threads: 4

# Additional Packages
packages:
  - base_testing_tools
  - performance_monitoring  # htop, iotop, nethogs, etc.
  - tcpreplay              # For high-volume traffic replay
  - network_tools          # iperf, netperf, etc.

# Snapshots
snapshots:
  create_baseline: true
  baseline_name: "high-throughput-baseline"

# Post-deployment Validation
validation:
  - command: "sudo corelightctl sensor status"
    expected: "running"
  - command: "nproc"
    description: "Verify CPU count"
  - command: "free -h"
    description: "Check available memory"
  - command: "ip link show eth1"
    description: "Verify monitor interface"

# Test Scenarios
test_scenarios:
  - High-volume traffic replay (10+ Gbps)
  - Packet loss detection under load
  - CPU and memory utilization
  - Disk I/O performance
  - Log throughput and retention
  - Performance degradation testing

# Performance Test Data
test_data:
  pcap_files:
    - /tmp/test_pcaps/high_volume_1gb.pcap
    - /tmp/test_pcaps/high_volume_10gb.pcap
  replay_speed:
    - 1x    # Real-time
    - 10x   # 10x speed
    - 100x  # 100x speed

# Monitoring Commands
monitoring:
  cpu: "mpstat 1"
  memory: "free -h && watch -n 1 free -h"
  network: "sudo iftop -i eth1"
  disk: "iostat -x 1"
  processes: "htop"

# Notes
notes: |
  High-Throughput Performance Testing Configuration

  This configuration uses a network-optimized EC2 instance (c6in.2xlarge)
  with enhanced networking capabilities.

  Instance Specs:
  - CPU: 8 vCPUs
  - Memory: 16 GB
  - Network: Up to 25 Gbps
  - EBS: Optimized

  Performance Testing Workflow:
  1. Baseline sensor performance (idle state)
  2. Replay low-volume traffic (1 Gbps)
  3. Gradually increase to max (10-25 Gbps)
  4. Monitor for packet loss, CPU, memory
  5. Identify performance bottlenecks
  6. Document sustainable throughput

  Key Metrics to Track:
  - Packets per second (pps)
  - Bits per second (bps)
  - Packet loss percentage
  - CPU utilization
  - Memory usage
  - Disk I/O wait
  - Log generation rate

  tcpreplay Commands:
  - Baseline: sudo tcpreplay -i eth1 --mbps=1000 test.pcap
  - Stress: sudo tcpreplay -i eth1 --topspeed test.pcap
  - Custom: sudo tcpreplay -i eth1 --pps=100000 test.pcap
